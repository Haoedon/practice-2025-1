## Анализ атак
___

**SQL injection vulnerability in WHERE clause**

**Последствия:**

* Утечка скрытых данных (например, товаров, которые не должны быть видны пользователям).

* Возможность извлечения конфиденциальной информации из базы данных (логины, пароли, персональные данные).

* Обход аутентификации, если инъекция позволяет модифицировать запросы авторизации.

**Риски:**

* Компрометация всей базы данных.

* Нарушение конфиденциальности и целостности данных.

**Blind OS command injection with time delays**

**Последствия:**

* Подтверждение уязвимости внедрения команд ОС через задержку выполнения.

* Возможность выполнения произвольных команд на сервере (например, чтение файлов, запуск процессов).

**Риски:**

* Полный контроль над сервером при наличии привилегий.

* Запуск вредоносных скриптов или бэкдоров.

**Blind OS command injection with output redirection**

**Последствия:**

* Запись результатов команд (например, whoami) в файлы на сервере.

* Чтение системных файлов (например, /etc/passwd), что может раскрыть учётные записи пользователей.

**Риски:**

* Эскалация привилегий, если команды выполняются от имени привилегированного пользователя.

* Размещение вредоносного ПО или скриптов на сервере.

**SSRF with filter bypass via open redirection vulnerability**

**Последствия:**

* Обход ограничений доступа к внутренним ресурсам (например, интерфейсу администратора).

* Удаление пользователей или изменение настроек системы.

**Риски:**

* Компрометация внутренней сети (например, доступ к API, базам данных).

* Выполнение административных действий от имени приложения.

**XXE Injection**

**Последствия:**

* Чтение локальных файлов (например, /etc/passwd), что раскрывает системную информацию.

* Возможность атак на внутренние сервисы (SSRF) или DoS-атак через обработку больших XML-файлов.

**Риски:**

* Утечка конфиденциальных данных (конфигурации, ключи, учётные записи).

* Повышение привилегий при взаимодействии с системными ресурсами.



## Способы защиты
___

**Как предотвратить SQL-инъекции?**
1. Используйте параметризованные запросы (Prepared Statements)
Вместо конкатенации строк в SQL-запросе применяйте подготовленные запросы с параметрами:

**Уязвимый код:**

```java
String query = "SELECT * FROM products WHERE category = '" + input + "'";
Statement statement = connection.createStatement();
ResultSet resultSet = statement.executeQuery(query);
```
**Исправленный код:**

```java
PreparedStatement statement = connection.prepareStatement("SELECT * FROM products WHERE category = ?");
statement.setString(1, input);
ResultSet resultSet = statement.executeQuery();
```
2. Ограничьте динамические части запроса
Если параметризованные запросы неприменимы (например, для имен таблиц или столбцов):

* Используйте белые списки разрешенных значений.

* Применяйте строгую валидацию (например, только буквы, цифры, подчеркивания).

3. Дополнительные меры:

* ORM-библиотеки (Hibernate, Entity Framework) автоматически экранируют SQL-запросы.

* Минимальные привилегии БД — ограничьте права учетной записи приложения.

* Регулярные аудиты кода и тестирование на уязвимости (например, SQLmap).

**Защита от SSRF-атак**

1. Валидация URL

* Разрешайте только безопасные схемы (http, https).

* Блокируйте приватные IP-адреса (10.0.0.0/8, 192.168.0.0/16).

2. Белые списки доменов

* Разрешайте запросы только к доверенным доменам/API.

3. Сегментация сети

* Изолируйте серверы, обрабатывающие внешние запросы, от критичной инфраструктуры.

4. Минимальные привилегии

* Используйте отдельные учётные записи с ограниченными правами для внешних запросов.

5. Таймауты и лимиты

* Устанавливайте таймауты (например, 5 сек) и ограничивайте размер ответов.

6. Дополнительные меры

* WAF (например, Cloudflare, ModSecurity).

* Применение изолированных окружений (песочниц).


**Защита от Command Injection**
1. Валидация ввода

* Запрещайте спецсимволы (;, &, |, $).

* Проверяйте входные данные на соответствие ожидаемому формату (например, только буквы и цифры).

2. Безопасные альтернативы

* Используйте встроенные API/библиотеки вместо вызова команд ОС.

    Пример: вместо system("ping $host") — socket или curl.

3. Белые списки

* Разрешайте только заранее одобренные команды и аргументы.

4. Логирование и мониторинг

* Фиксируйте все вызовы команд в логах.

* Настройте алерты на подозрительную активность.


**Защита от XXE-инъекций**
1. Отключите обработку внешних сущностей

* В XML-парсерах: setFeature("http://apache.org/xml/features/disallow-doctype-decl", true)

* Запретите DTD и внешние ссылки.

* Используйте безопасные XML-парсеры

* Выбирайте библиотеки с защитой по умолчанию (например, defusedxml для Python).

**Валидация и ограничения**

* Проверяйте структуру XML.

* Ограничьте размер файлов.

**Изоляция парсера**

* Запускайте в песочнице без доступа к файловой системе/сети.

**Обновления и WAF**

* Регулярно обновляйте библиотеки.

* Настройте WAF для блокировки XXE.
